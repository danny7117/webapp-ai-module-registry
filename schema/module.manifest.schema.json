{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schema/module.manifest.schema.json",
  "title": "WebApp AI Module Manifest",
  "type": "object",
  "additionalProperties": false,
  "required": ["id", "name", "version", "capabilities", "inputs", "outputs", "resources", "policy", "tests"],
  "properties": {
    "__skip_ci": { "type": "boolean" },

    "id": { "type": "string", "minLength": 1 },
    "name": { "type": "string", "minLength": 1 },

    "version": {
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[\\da-z-]+(?:\\.[\\da-z-]+)*)?(?:\\+[\\da-z-]+(?:\\.[\\da-z-]+)*)?$"
    },

    "category": {
      "type": "string",
      "enum": ["core", "utility", "creative", "business"]   // 智慧模組庫四大類別
    },

    "capabilities": {
      "type": "array",
      "items": { "type": "string", "minLength": 1 },
      "minItems": 1
    },

    "inputs": { "type": "object" },
    "outputs": { "type": "object" },

    "dependencies": {
      "type": "array",
      "items": { "type": "string", "minLength": 1 },
      "default": []
    },

    "conflicts": {
      "type": "array",
      "items": { "type": "string", "minLength": 1 },
      "default": []
    },

    "resources": {
      "type": "object",
      "required": ["bundle_kb", "cpu_ms", "mem_mb"],
      "properties": {
        "bundle_kb": { "type": "number", "minimum": 0 },
        "cpu_ms": { "type": "number", "minimum": 0 },
        "mem_mb": { "type": "number", "minimum": 0 }
      }
    },

    "policy": {
      "type": "object",
      "required": ["age", "license", "offline_ok"],
      "properties": {
        "age": { "type": "string", "enum": ["all", "7+", "12+", "15+", "18+"] },
        "license": { "type": "string" },
        "offline_ok": { "type": "boolean" }
      }
    },

    "tests": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["name", "input", "expect"],
        "properties": {
          "name": { "type": "string" },
          "input": { "type": "object" },
          "expect": { "type": "object" }
        },
        "additionalProperties": false
      }
    },

    "changelog": { "type": "string", "default": "" }
  }
}
